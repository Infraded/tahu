# Reference
<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

**Functions**

* [`tahu::attributes`](#tahuattributes): Returns the attributes of an Object or Type The returned value is a hash mapping attribute name to the data type for that attribute.  ```pupp
* [`tahu::callable_signature`](#tahucallable_signature): Produces an Array of Callable signatures (parameters with types, and returned type)  of functions.  The callable_signature() function returns
* [`tahu::convert_from_rich_data`](#tahuconvert_from_rich_data): Converts a value from a `RichData` compliant data structure to the actual data. This is the reverse of `tahu::convert_to_rich_data()`.
* [`tahu::convert_to_rich_data`](#tahuconvert_to_rich_data): Converts a value to a `RichData` compliant data structure
* [`tahu::eval`](#tahueval): Evaluates a string containing Puppet Language source. The primary intended use case is to combine `eval` with `Deferred` to enable evaluating
* [`tahu::get_attr`](#tahuget_attr): Returns the value of a given attribute of an Object or Type
* [`tahu::is_callable_with`](#tahuis_callable_with): Answers if one of the given `Type[Callable]` can be called with the given arguments and optional block.  The function can be called with one 
* [`tahu::signature`](#tahusignature): Returns the type signature (parameters with types, and returned type) of "callable" entities.  The signature() function can return a signatur
* [`tahu::stacktrace`](#tahustacktrace): Returns a full Puppet stacktrace.  This function returns an `Array[Tuple[String, Integer]]` where each tuple represents a call on the form `[
* [`tahu::to_type`](#tahuto_type): Converts a type in String format to an actual instance of Type ```puppet $int_type = tahu::convert_string_to_type("Integer[1,2]") ```
* [`tahu::where`](#tahuwhere): Returns an array with [file, line] of the manifest calling this function. When the call is from source that does not come from a function, th

## Functions

### tahu::attributes

Type: Ruby 4.x API

Returns the attributes of an Object or Type
The returned value is a hash mapping attribute name to the data type for that attribute.

```puppet
notice(tahu::attributes(Integer)).keys
# Would notice `["to", "from"]`
```

```puppet
type MyThing = Object[attributes => { example => String }]
notice(tahu::attributes(MyThing)
# Would notice { "example" => String }
```puppet

```puppet
type MyThing = Object[attributes => { example => String }]
$a_thing = MyThing("hello")
notice(tahu::attributes($a_thing)
# Would notice { "example" => String }
```puppet

If the given type (or type of Object) has no attributes and empty hash will be returned.

#### `tahu::attributes(Type[Object] $value)`

The tahu::attributes function.

Returns: `Hash[String, Type]`

##### `value`

Data type: `Type[Object]`



#### `tahu::attributes(Type $value)`

The tahu::attributes function.

Returns: `Hash[String, Type]`

##### `value`

Data type: `Type`



#### `tahu::attributes(Object $value)`

The tahu::attributes function.

Returns: `Hash[String, Type]`

##### `value`

Data type: `Object`



### tahu::callable_signature

Type: Ruby 4.x API

Produces an Array of Callable signatures (parameters with types, and returned type)  of functions.

The callable_signature() function returns an Array with one or more `Type[Callable]` describing how a function can be called,
or how the `new` function of a data type can be called.

```puppet
notice(tahu::callable_signature("size"))
```
Would notice: `[Callable[Variant[Collection, String, Binary]]]`

Data Type signatures are produced as function signatures for the respective type's `new` function
except for `CatalogEntry` data types since they have different semantics and for which this function returns `undef`.
The value `undef` is also returned for non existing functions and for data types that do not have a `new` function.

#### `tahu::callable_signature(String $function)`

The tahu::callable_signature function.

Returns: `Optional[Array[Type[Callable]]]`

##### `function`

Data type: `String`



#### `tahu::callable_signature(Type $type)`

The tahu::callable_signature function.

Returns: `Optional[Array[Type[Callable]]]`

##### `type`

Data type: `Type`



### tahu::convert_from_rich_data

Type: Ruby 4.x API

Converts a value from a `RichData` compliant data structure to the actual data.
This is the reverse of `tahu::convert_to_rich_data()`.

#### `tahu::convert_from_rich_data(RichData $value)`

Converts a value from a `RichData` compliant data structure to the actual data.
This is the reverse of `tahu::convert_to_rich_data()`.

Returns: `Any`

##### `value`

Data type: `RichData`



### tahu::convert_to_rich_data

Type: Ruby 4.x API

Converts a value to a `RichData` compliant data structure

#### `tahu::convert_to_rich_data(Any $value)`

Converts a value to a `RichData` compliant data structure

Returns: `Any`

##### `value`

Data type: `Any`



### tahu::eval

Type: Ruby 4.x API

Evaluates a string containing Puppet Language source.
The primary intended use case is to combine `eval` with
`Deferred` to enable evaluating arbitrary code on the agent side
when applying a catalog.

```puppet
tahu::eval("\$x + \$y", { 'x' => 10, 'y' => 20}) # produces 30
```

Note the escaped `$` characters since interpolation is unwanted.

```puppet
Deferred('tahu::eval' ["\$x + \$y", { 'x' => 10, 'y' => 20})] # produces 30 on the agent
```

This function can be used when there is the need to format or transform deferred
values since doing that with only deferred values can be difficult to construct
or impossible to achieve when a lambda is needed.

```puppet
Deferred('tahu::eval', "local_lookup('key').filter |\$x| { \$x =~ Integer }")
```

To assert the return type - this is simply done by calling `assert_type`
as part of the string to evaluate.

```puppet
tahu::eval("assert_type(Integer, \$x + \$y))", { 'x' => 10, 'y' => 20})
```

#### Examples

##### Using `eval`

```puppet

```

##### Evaluating logic on agent requiring use of "filter"

```puppet

```

#### `tahu::eval(String $code, Optional[Hash[String, Any]] $variables)`

Evaluates a string containing Puppet Language source.
The primary intended use case is to combine `eval` with
`Deferred` to enable evaluating arbitrary code on the agent side
when applying a catalog.

```puppet
tahu::eval("\$x + \$y", { 'x' => 10, 'y' => 20}) # produces 30
```

Note the escaped `$` characters since interpolation is unwanted.

```puppet
Deferred('tahu::eval' ["\$x + \$y", { 'x' => 10, 'y' => 20})] # produces 30 on the agent
```

This function can be used when there is the need to format or transform deferred
values since doing that with only deferred values can be difficult to construct
or impossible to achieve when a lambda is needed.

```puppet
Deferred('tahu::eval', "local_lookup('key').filter |\$x| { \$x =~ Integer }")
```

To assert the return type - this is simply done by calling `assert_type`
as part of the string to evaluate.

```puppet
tahu::eval("assert_type(Integer, \$x + \$y))", { 'x' => 10, 'y' => 20})
```

Returns: `Any`

##### Examples

###### Using `eval`

```puppet

```

###### Evaluating logic on agent requiring use of "filter"

```puppet

```

##### `code`

Data type: `String`



##### `variables`

Data type: `Optional[Hash[String, Any]]`



### tahu::get_attr

Type: Ruby 4.x API

Returns the value of a given attribute of an Object or Type

#### `tahu::get_attr(Type[Object] $value, String $name)`

The tahu::get_attr function.

Returns: `Any`

##### `value`

Data type: `Type[Object]`



##### `name`

Data type: `String`



#### `tahu::get_attr(Type $value, String $name)`

The tahu::get_attr function.

Returns: `Any`

##### `value`

Data type: `Type`



##### `name`

Data type: `String`



#### `tahu::get_attr(Object $value, String $name)`

The tahu::get_attr function.

Returns: `Any`

##### `value`

Data type: `Object`



##### `name`

Data type: `String`



### tahu::is_callable_with

Type: Ruby 4.x API

Answers if one of the given `Type[Callable]` can be called with the given arguments and optional block.

The function can be called with one `Type[Callable]` or an `Array[Type[Callable]]` (the later is
what is produced by `tahu::callable_signatures()`).

This function returns a `Boolean` indicating if the given function can be called or not with the given arguments and block.

```puppet
tahu::callable_signature('size').is_callable_with([]).notice
```
Would notice `true`

#### `tahu::is_callable_with(Type[Callable] $callable_t, Any *$arguments, Optional[Callable] &$block)`

The tahu::is_callable_with function.

Returns: `Boolean`

##### `callable_t`

Data type: `Type[Callable]`



##### `*arguments`

Data type: `Any`



##### `&block`

Data type: `Optional[Callable]`



#### `tahu::is_callable_with(Array[Type[Callable]] $callables, Any *$arguments, Optional[Callable] &$block)`

The tahu::is_callable_with function.

Returns: `Boolean`

##### `callables`

Data type: `Array[Type[Callable]]`



##### `*arguments`

Data type: `Any`



##### `&block`

Data type: `Optional[Callable]`



### tahu::signature

Type: Ruby 4.x API

Returns the type signature (parameters with types, and returned type) of "callable" entities.

The signature() function can return a signature for:
* Functions
* Native resource types (for example `File`).
* Classes (i.e. created by `class` in Puppet Language).
* user defined resource types (i.e. created by `define` in Puppet Language).

*Function Signatures* are obtained by giving the functions name as a String.

```puppet
notice(tahu::signature("size"))
```
Would notice: `[{parameters => {arg => {type => Variant[Collection, String, Binary]}}, return_type => Any}]`

*Data Type signatures* are produced as function signatures for the respective type's `new` function
except for `CatalogEntry` data types since they have different semantics.
For `CatalogEntry` data types it is also possible to obtain a signature with (or without) meta parameters.

The `CatalogEntry` data types are:
* `Resource[<typename>]` - used to get the signature of a resource type. Short form aliases can be used, for example `File`.
* `Class[<classname>]` - used to get the signature of a class.

```puppet
class testing(Integer $x, String $y) { }
notice(tahu::signature(Class['testing']))
```
Would notice `{x => {type => Integer}, y => {type => String}}`

```puppet
notice(tahu::signature(Class['testing'], true))
```

```puppet
tahu::signature(Class['testing'])['parameters'].keys()
```
*Non CatalogEntry signatures* are produced for a data type's `new` function.

```puppet
notice(tahu::signature(Integer))
```
Would notice this quite long signature:
```puppet
[
 { parameters => {
      from  => {type => Convertible = Variant[Numeric, Boolean, Pattern[/\A[+-]?\s*(?:(?:\d+)|(?:0[xX][0-9A-Fa-f]+)|(?:0[bB][01]+))\z/], Timespan, Timestamp]},
      radix => {type => Radix = Variant[Default, Integer[2, 2], Integer[8, 8], Integer[10, 10], Integer[16, 16]]},
      abs   => {type => Boolean, optional => true}
    },
    return_type => Any
  },
 { parameters => {
   hash_args => {
     type => NamedArgs = Struct[{
      'from'            => Convertible = Variant[Numeric, Boolean, Pattern[/\A[+-]?\s*(?:(?:\d+)|(?:0[xX][0-9A-Fa-f]+)|(?:0[bB][01]+))\z/], Timespan, Timestamp],
      Optional['radix'] => Radix = Variant[Default, Integer[2, 2], Integer[8, 8], Integer[10, 10], Integer[16, 16]],
      Optional['abs']   => Boolean
   }]}},
  return_type => Any
 }
]
```
Note that the output shown above is a snapshot of the signature of `Integer.new` - it may be different in your version of Puppet. Also note
that the stringified output shown above show expanded type aliases - for example `Convertible = Variant[...]` which
is how such a type alias is expanded into a String.

### Returned values

`Resource` and `Class` data types always have a single signature and use "named arguments".
Functions use "positional arguments", and they may have multiple signatures (multiple different sequences of positional parameters).
Functions also have "return type", support a repeating argument, and possibly a block (lambda).
Note that the signature for general data types are for the respective `new` function of a data type, and this signature
includes a variant where arguments are given as a struct - looking very much like an "named arguments" call.

For resources and classes the returned signature is a `Hash` with parameter names as keys, and each value being a hash of:
* `"type"` - `Type`, the type of the parameter
* `"optional"` - `Boolean`, set to `true` if value has a default value expression, (not present otherwise)
* `"meta"` - `Boolean`, set to `true` if value is a meta parameters - key not present for regular parameters

When the optional parameter `include_meta_params` is set to `true`, the meta parameters will also be included
in the result. This option defaults to `false`.

For functions (including general data type's `new` function), the returned information is an `Array` where each entry is
one signature. Each signature is a `Hash` with the keys:
* `"parameters"` - `Hash`, information about each parameter - the keys are the names of the parameters and each value is
  a hash with the keys `"type"` `Type`, and `"optional"` `Boolean`, and if the parameter is the last and repeating it will
  also have a `"repeating"` key set to `true`. The `"optional"` key is only present if the value is `true`.
* `"return_type"` - `Type`, the return type - is set to `Any` for functions that does not specify a return type
* `"block_type"` - `Type`, the type of a block if a block is accepted otherwise not present. When a function accepts a block
  the type is either a `Callable` if the block is required, or `Optional[Callable]` if the block is optional. The `Callable` data type
  further specifies the block's parameters and their types.

Since Puppet Language hashes have ordered entries, the hash also describe the position of each parameter.

The `signature()` function returns `undef` in case the given function name references a function that does not exist,
if a given data type does not exist, or if it does not have a `new` function.

*Related Information*
* To ask if a value can be used in a call to create a new instance of a type `T` use `$val =~ Init[T]`
* To ask if a `Callable` can be called with given values call `tahu::is_callable_with()`

#### `tahu::signature(String $function)`

The tahu::signature function.

Returns: `Optional[Array[Hash]]`

##### `function`

Data type: `String`



#### `tahu::signature(Variant[Type[CatalogEntry], Type[Type[CatalogEntry]]] $entity, Optional[Boolean] $include_meta_params)`

The tahu::signature function.

Returns: `Optional[Hash]`

##### `entity`

Data type: `Variant[Type[CatalogEntry], Type[Type[CatalogEntry]]]`



##### `include_meta_params`

Data type: `Optional[Boolean]`



#### `tahu::signature(Type $type)`

The tahu::signature function.

Returns: `Optional[Array[Hash]]`

##### `type`

Data type: `Type`



### tahu::stacktrace

Type: Ruby 4.x API

Returns a full Puppet stacktrace.

This function returns an `Array[Tuple[String, Integer]]` where each tuple represents a call on the form
`[<file>, <line>]`. The first entry in the array is the location calling the `stacktrace()` function.

If "file" is not know (for example when called from the command line) it
is set to "unknown".

Would produce `[unknown, 1]`.

Also see `tahu::where()` for getting only the top of the stack (which is much faster than getting the entire stack
and extracting only the immediate caller).

(This function uses Puppet's Puppet::Pops::PuppetStack Ruby API. If something is not showing in the stack
then this is a problem in Puppet, not in this function).

#### `tahu::stacktrace(Optional[Any] $full_stack = false)`

Returns a full Puppet stacktrace.

This function returns an `Array[Tuple[String, Integer]]` where each tuple represents a call on the form
`[<file>, <line>]`. The first entry in the array is the location calling the `stacktrace()` function.

If "file" is not know (for example when called from the command line) it
is set to "unknown".

Would produce `[unknown, 1]`.

Also see `tahu::where()` for getting only the top of the stack (which is much faster than getting the entire stack
and extracting only the immediate caller).

(This function uses Puppet's Puppet::Pops::PuppetStack Ruby API. If something is not showing in the stack
then this is a problem in Puppet, not in this function).

Returns: `Any`

##### `full_stack`

Data type: `Optional[Any]`



### tahu::to_type

Type: Ruby 4.x API

Converts a type in String format to an actual instance of Type
```puppet
$int_type = tahu::convert_string_to_type("Integer[1,2]")
```

#### `tahu::to_type(String $type_string)`

Converts a type in String format to an actual instance of Type
```puppet
$int_type = tahu::convert_string_to_type("Integer[1,2]")
```

Returns: `Any`

##### `type_string`

Data type: `String`



### tahu::where

Type: Ruby 4.x API

Returns an array with [file, line] of the manifest calling this function.
When the call is from source that does not come from a function, the "file" entry will
be set to the string "unknown".
In case the function is not called from a puppet manifest, an array of `[undef, undef]` will
be returned.

Also see `tahu::stacktrace()` for getting the full stacktrace.

#### `tahu::where()`

Returns an array with [file, line] of the manifest calling this function.
When the call is from source that does not come from a function, the "file" entry will
be set to the string "unknown".
In case the function is not called from a puppet manifest, an array of `[undef, undef]` will
be returned.

Also see `tahu::stacktrace()` for getting the full stacktrace.

Returns: `Any`

